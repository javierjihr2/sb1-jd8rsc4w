"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4260],{22424:(e,t,a)=>{a.d(t,{Ds:()=>g,Hv:()=>m,Jv:()=>u,Ss:()=>c,bA:()=>l,hR:()=>p,mT:()=>h,ul:()=>f});var r=a(56104),n=a(35317),s=a(6033),o=a(68598);async function i(e){try{let t=(0,o.Ip)(e);if(!t.isValid)return{success:!1,error:t.errors.join(", ")};let a={...e,createdAt:new Date,expiresAt:e.expiresAt||new Date(Date.now()+6048e5)},s=await (0,n.gS)((0,n.rJ)(r.db,"notifications"),a),i=(0,n.P)((0,n.rJ)(r.db,"notificationSubscriptions"),(0,n._M)("userId","==",e.userId),(0,n._M)("active","==",!0)),c=(await (0,n.GG)(i)).docs.map(async e=>{let t=e.data();try{await d(t,a)}catch(t){console.error("Error sending to device:",t),await (0,n.mZ)((0,n.H9)(r.db,"notificationSubscriptions",e.id),{active:!1})}});return await Promise.allSettled(c),{success:!0,notificationId:s.id}}catch(a){console.error("Error sending push notification:",a);let t=s.$2.messageSend(e.userId,{operation:"sendPushNotification",notification:e},"high"===e.priority?"high":"medium");return{success:!1,error:a instanceof Error?a.message:"Unknown error",retryId:t}}}async function d(e,t){console.log("Sending notification to device:",{endpoint:e.endpoint,notification:{title:t.title,body:t.body,data:t.data}}),await new Promise(e=>setTimeout(e,100))}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{let s=(0,n.P)((0,n.rJ)(r.db,"notifications"),(0,n._M)("userId","==",e),(0,n.My)("createdAt","desc"),(0,n.AB)(t));a&&(s=(0,n.P)((0,n.rJ)(r.db,"notifications"),(0,n._M)("userId","==",e),(0,n._M)("read","==",!1),(0,n.My)("createdAt","desc"),(0,n.AB)(t)));let o=(await (0,n.GG)(s)).docs.map(e=>({id:e.id,...e.data()}));return{success:!0,notifications:o}}catch(e){return console.error("Error getting user notifications:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function l(e){try{return await (0,n.mZ)((0,n.H9)(r.db,"notifications",e),{read:!0}),{success:!0}}catch(a){console.error("Error marking notification as read:",a);let t=s.$2.messageSend("system",{operation:"markNotificationAsRead",notificationId:e},"low");return{success:!1,error:a instanceof Error?a.message:"Unknown error",retryId:t}}}function u(e,t){let a=(0,n.P)((0,n.rJ)(r.db,"notifications"),(0,n._M)("userId","==",e),(0,n.My)("createdAt","desc"),(0,n.AB)(50));return(0,n.aQ)(a,e=>{t(e.docs.map(e=>({id:e.id,...e.data()})))})}async function f(e){try{let t=(0,n.P)((0,n.rJ)(r.db,"notifications"),(0,n._M)("userId","==",e),(0,n._M)("read","==",!1)),a=await (0,n.GG)(t);return{success:!0,count:a.size}}catch(e){return console.error("Error getting unread notification count:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function m(e,t,a,r){return i({userId:e,type:"message",title:"Nuevo mensaje de ".concat(t),body:a,data:{chatId:r,type:"message"},read:!1,priority:"high",actionUrl:"/chats/".concat(r)})}async function p(e,t,a){return i({userId:e,type:"friend_request",title:"Nueva solicitud de amistad",body:"".concat(t," te ha enviado una solicitud de amistad"),data:{senderId:a,type:"friend_request"},read:!1,priority:"normal",actionUrl:"/friends"})}async function g(e,t,a,r){try{let n,s,o="normal";switch(a){case"registered":n="Registro confirmado",s="Te has registrado exitosamente en ".concat(t);break;case"waitlisted":n="En lista de espera",s="Has sido agregado a la lista de espera de ".concat(t);break;case"moved-from-waitlist":n="\xa1Registro confirmado!",s="Has sido movido de la lista de espera a participante activo en ".concat(t),o="high";break;case"tournament-starting":n="Torneo iniciando",s="".concat(t," est\xe1 a punto de comenzar"),o="high";break;case"tournament-cancelled":n="Torneo cancelado",s="".concat(t," ha sido cancelado"),o="high";break;default:n="Actualizaci\xf3n de torneo",s="Hay una actualizaci\xf3n sobre ".concat(t)}return await i({userId:e,type:"tournament_invite",title:n,body:s,priority:o,read:!1,actionUrl:"/tournaments/".concat(r),data:{tournamentId:r,tournamentTitle:t,notificationType:a,type:"tournament"}})}catch(e){return console.error("Error sending tournament notification:",e),{success:!1,error:"Failed to send tournament notification"}}}async function h(){try{if(!("Notification"in window))return{success:!1,error:"Este navegador no soporta notificaciones"};if("granted"===Notification.permission)return{success:!0,permission:"granted"};let e=await Notification.requestPermission();return{success:"granted"===e,permission:e,error:"denied"===e?"Permisos de notificaci\xf3n denegados":void 0}}catch(e){return console.error("Error requesting notification permission:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}},44838:(e,t,a)=>{a.d(t,{I:()=>f,SQ:()=>m,_2:()=>p,lp:()=>g,mB:()=>h,rI:()=>l,ty:()=>u});var r=a(95155),n=a(12115),s=a(76215),o=a(73158),i=a(10518),d=a(70154),c=a(59434);let l=s.bL,u=s.l9,f=s.YJ;s.ZL,s.Pb,s.z6,n.forwardRef((e,t)=>{let{className:a,inset:n,children:i,...d}=e;return(0,r.jsxs)(s.ZP,{ref:t,className:(0,c.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",n&&"pl-8",a),...d,children:[i,(0,r.jsx)(o.A,{className:"ml-auto"})]})}).displayName=s.ZP.displayName,n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(s.G5,{ref:t,className:(0,c.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})}).displayName=s.G5.displayName;let m=n.forwardRef((e,t)=>{let{className:a,sideOffset:n=4,...o}=e;return(0,r.jsx)(s.ZL,{children:(0,r.jsx)(s.UC,{ref:t,sideOffset:n,className:(0,c.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...o})})});m.displayName=s.UC.displayName;let p=n.forwardRef((e,t)=>{let{className:a,inset:n,...o}=e;return(0,r.jsx)(s.q7,{ref:t,className:(0,c.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",n&&"pl-8",a),...o})});p.displayName=s.q7.displayName,n.forwardRef((e,t)=>{let{className:a,children:n,checked:o,...d}=e;return(0,r.jsxs)(s.H_,{ref:t,className:(0,c.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:o,...d,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(s.VF,{children:(0,r.jsx)(i.A,{className:"h-4 w-4"})})}),n]})}).displayName=s.H_.displayName,n.forwardRef((e,t)=>{let{className:a,children:n,...o}=e;return(0,r.jsxs)(s.hN,{ref:t,className:(0,c.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...o,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(s.VF,{children:(0,r.jsx)(d.A,{className:"h-2 w-2 fill-current"})})}),n]})}).displayName=s.hN.displayName;let g=n.forwardRef((e,t)=>{let{className:a,inset:n,...o}=e;return(0,r.jsx)(s.JU,{ref:t,className:(0,c.cn)("px-2 py-1.5 text-sm font-semibold",n&&"pl-8",a),...o})});g.displayName=s.JU.displayName;let h=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(s.wv,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",a),...n})});h.displayName=s.wv.displayName},66424:(e,t,a)=>{a.d(t,{F:()=>i});var r=a(95155),n=a(12115),s=a(47655),o=a(59434);let i=n.forwardRef((e,t)=>{let{className:a,children:n,...i}=e;return(0,r.jsxs)(s.bL,{ref:t,className:(0,o.cn)("relative overflow-hidden",a),...i,children:[(0,r.jsx)(s.LM,{className:"h-full w-full rounded-[inherit]",children:n}),(0,r.jsx)(d,{}),(0,r.jsx)(s.OK,{})]})});i.displayName=s.bL.displayName;let d=n.forwardRef((e,t)=>{let{className:a,orientation:n="vertical",...i}=e;return(0,r.jsx)(s.VM,{ref:t,orientation:n,className:(0,o.cn)("flex touch-none select-none transition-colors","vertical"===n&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===n&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...i,children:(0,r.jsx)(s.lr,{className:"relative flex-1 rounded-full bg-border"})})});d.displayName=s.VM.displayName}}]);