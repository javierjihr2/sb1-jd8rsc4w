"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[988],{10988:(e,t,r)=>{r.d(t,{$b:()=>A,$o:()=>S,Qo:()=>M,RJ:()=>v,Uf:()=>E,VM:()=>l,Vz:()=>d,W5:()=>R,Z1:()=>_,bW:()=>I,createFeedPost:()=>P,dE:()=>O,ix:()=>z,lR:()=>j,qt:()=>G,sendMessage:()=>D,sh:()=>i,u4:()=>J,updateUserProfile:()=>f,vp:()=>B,y9:()=>b});var a=r(35317),s=r(56104),o=r(68598),n=r(6033);let c=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Firestore operation";try{return await e()}catch(r){let e=(null==r?void 0:r.message)||(null==r?void 0:r.toString())||"Error desconocido";if(e.includes("ERR_ABORTED")||e.includes("offline")||console.warn("⚠️ Error en ".concat(t,":"),e),e.includes("offline")||e.includes("ERR_ABORTED"))throw console.log("\uD83D\uDCF1 Operaci\xf3n ".concat(t," ejecutada en modo offline")),r}},i=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;try{return await c(async()=>{let r=(0,a.P)((0,a.rJ)(s.db,"matches"),(0,a.My)("createdAt","desc"),(0,a.AB)(t));return e&&(r=(0,a.P)((0,a.rJ)(s.db,"matches"),(0,a._M)("user1Id","==",e),(0,a.My)("createdAt","desc"),(0,a.AB)(t))),(await (0,a.GG)(r)).docs.map(e=>({id:e.id,...e.data()}))},"getMatches")}catch(e){return console.error("Error getting matches:",e),[]}},d=async(e,t)=>{try{let r=(0,a.H9)(s.db,"users",e);return await (0,a.BN)(r,{id:e,...t,createdAt:(0,a.O5)(),updatedAt:(0,a.O5)()},{merge:!0}),{success:!0}}catch(e){return console.error("Error creating user profile:",e),{success:!1,error:e}}},l=async e=>{try{return await c(async()=>{let t=(0,a.H9)(s.db,"users",e),r=await (0,a.x7)(t);return r.exists()?{id:r.id,...r.data()}:null},"getUserProfile")}catch(e){if(e instanceof Error&&(e.message.includes("offline")||e.message.includes("ERR_ABORTED")))return console.log("\uD83D\uDCF1 Database: getUserProfile ejecutado en modo offline - devolviendo null"),null;return console.error("Error getting user profile after retries:",e),null}},u=new Map,g=new Set,p=(e,t)=>{let r="pending_profile_".concat(e),a="profile_backup_".concat(e);try{let s={...JSON.parse(localStorage.getItem(r)||"{}"),...t,lastModified:Date.now(),syncStatus:"pending",sessionId:Math.random().toString(36).substr(2,9)};localStorage.setItem(r,JSON.stringify(s)),localStorage.setItem(a,JSON.stringify(s)),u.set(e,s),console.log("\uD83D\uDCBE Datos guardados localmente:",{userId:e,updates:Object.keys(t)}),window.dispatchEvent(new CustomEvent("profileDataSaved",{detail:{userId:e,updates:t,timestamp:Date.now()}}))}catch(t){console.error("❌ Error guardando datos localmente:",t);try{let r={userId:e,lastModified:Date.now(),syncStatus:"error",errorDetails:t};localStorage.setItem("error_log_".concat(e),JSON.stringify(r))}catch(e){console.error("❌ Error cr\xedtico guardando datos:",e)}}},m=e=>{let t="pending_profile_".concat(e);localStorage.removeItem(t),u.delete(e),g.delete(e)},y=async()=>{for(let e of g){let t=u.get(e);if(t)try{await h(e,t),m(e),console.log("✅ Sincronizado perfil pendiente para:",e)}catch(t){console.log("⏳ Reintentando sincronizaci\xf3n m\xe1s tarde para:",e)}}},w=async()=>{if("undefined"!=typeof localStorage)try{for(let e of(await y(),Object.keys(localStorage).filter(e=>e.startsWith("profile_")||e.startsWith("pending_profile_")||"currentProfile"===e)))try{let t=localStorage.getItem(e);if(t){let e=JSON.parse(t);e.id&&e.needsSync&&g.add(e.id)}}catch(t){console.warn("Error verificando clave de perfil ".concat(e,":"),t),localStorage.removeItem(e)}}catch(e){console.error("Error en sincronizaci\xf3n mejorada:",e)}};setInterval(w,3e4),document.addEventListener("visibilitychange",()=>{document.hidden||w()});let h=async(e,t)=>{let r=(0,a.H9)(s.db,"users",e);(await (0,a.x7)(r)).exists()?await (0,a.mZ)(r,{...t,updatedAt:(0,a.O5)()}):await (0,a.BN)(r,{id:e,...t,createdAt:(0,a.O5)(),updatedAt:(0,a.O5)()})},f=async(e,t)=>{let r=t;try{console.log("\uD83D\uDD04 Database: Iniciando actualizaci\xf3n de perfil para userId:",e),console.log("\uD83D\uDCDD Database: Datos a actualizar:",t);let a=(0,o.DV)(t);if(!a.isValid)throw console.error("❌ Datos no v\xe1lidos:",a.errors),Error("Datos no v\xe1lidos: ".concat(a.errors.join(", ")));r=a.sanitizedData,console.log("✅ Datos validados y sanitizados:",r),p(e,r),g.add(e);let s=await c(async()=>(await h(e,r),{success:!0}),"updateUserProfile");return m(e),console.log("✅ Database: Perfil actualizado exitosamente"),s}catch(o){console.error("❌ Database: Error updating user profile:",o);let a=n.$2.profileUpdate(e,r||t,"high");console.log("\uD83D\uDD04 Database: Operaci\xf3n agregada a cola de reintentos: ".concat(a)),console.log("\uD83D\uDCF1 Database: Datos guardados localmente, se sincronizar\xe1n autom\xe1ticamente");let s="Datos guardados localmente, reintentando autom\xe1ticamente...";return o instanceof Error&&(o.message.includes("permission")?s="Sin permisos para actualizar el perfil. Reintentando...":o.message.includes("network")&&(s="Error de red. Datos guardados, reintentando autom\xe1ticamente.")),{success:!1,error:{message:s,originalError:o,retryId:a}}}},b=async e=>{try{let t=(0,a.P)((0,a.rJ)(s.db,"tournament_registrations"),(0,a._M)("tournamentId","==",e),(0,a.My)("createdAt","desc"));return(await (0,a.GG)(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting tournament registrations:",e),[]}},D=async(e,t,r)=>{let c;try{let n=(0,o.ue)(r);if(!n.isValid)throw console.error("❌ Datos del mensaje no v\xe1lidos:",n.errors),Error("Datos del mensaje no v\xe1lidos: ".concat(n.errors.join(", ")));if(!(c=n.sanitizedData))throw Error("Error en la validaci\xf3n de datos del mensaje");let i={...r,content:c.content,type:c.type||r.type||"text",senderId:t,timestamp:(0,a.O5)()};await (0,a.gS)((0,a.rJ)(s.db,"chats",e,"messages"),i);let d=(0,a.H9)(s.db,"chats",e);return await (0,a.mZ)(d,{lastMessage:c.content,lastMessageTimestamp:(0,a.O5)()}),{success:!0}}catch(s){console.error("❌ Database: Error sending message:",s);let a=n.$2.messageSend(t,{chatId:e,message:{...r,content:(null==c?void 0:c.content)||r.content,type:(null==c?void 0:c.type)||r.type||"text"}},"high");return console.log("\uD83D\uDD04 Database: Mensaje agregado a cola de reintentos: ".concat(a)),{success:!1,error:s,retryId:a}}},E=async e=>{try{let t=await (0,a.gS)((0,a.rJ)(s.db,"news"),{...e,createdAt:(0,a.O5)(),updatedAt:(0,a.O5)(),views:0,likes:0,comments:[]});return{success:!0,id:t.id}}catch(e){return console.error("Error creating news article:",e),{success:!1,error:e}}},v=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1?arguments[1]:void 0;try{let r=(0,a.P)((0,a.rJ)(s.db,"news"),(0,a.My)("date","desc"),(0,a.AB)(e));return t&&(r=(0,a.P)((0,a.rJ)(s.db,"news"),(0,a._M)("category","==",t),(0,a.My)("date","desc"),(0,a.AB)(e))),(await (0,a.GG)(r)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting news articles:",e),[]}},S=async(e,t)=>{try{let r=(0,a.H9)(s.db,"news",e);return await (0,a.mZ)(r,{...t,updatedAt:(0,a.O5)()}),{success:!0}}catch(e){return console.error("Error updating news article:",e),{success:!1,error:e}}},A=async e=>{try{let t=(0,a.H9)(s.db,"news",e);return await (0,a.mZ)(t,{isDeleted:!0,updatedAt:(0,a.O5)()}),{success:!0}}catch(e){return console.error("Error deleting news article:",e),{success:!1,error:e}}},O=async(e,t)=>{try{let r=(0,a.H9)(s.db,"news",e);return await (0,a.mZ)(r,{likes:(0,a.GV)(1),likedBy:(0,a.hq)(t)}),{success:!0}}catch(e){return console.error("Error liking news article:",e),{success:!1,error:e}}},_=async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20;try{let o=(0,a.rJ)(s.db,"services");return o=e&&t?(0,a.P)(o,(0,a._M)("category","==",e),(0,a._M)("creatorId","==",t)):e?(0,a.P)(o,(0,a._M)("category","==",e),(0,a._M)("isActive","==",!0)):t?(0,a.P)(o,(0,a._M)("creatorId","==",t)):(0,a.P)(o,(0,a._M)("isActive","==",!0)),o=(0,a.P)(o,(0,a.My)("createdAt","desc"),(0,a.AB)(r)),(await (0,a.GG)(o)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting services:",e),[]}},M=async(e,t,r)=>{try{let o=await (0,a.gS)((0,a.rJ)(s.db,"orders"),{serviceId:e,userId:t,...r,status:"pending",createdAt:(0,a.O5)()}),n=(0,a.H9)(s.db,"services",e);return await (0,a.mZ)(n,{orders:(0,a.GV)(1)}),{success:!0,orderId:o.id}}catch(e){return console.error("Error ordering service:",e),{success:!1,error:e}}},P=async e=>{try{let t=(0,o.nT)(e);if(!t.isValid)throw console.error("❌ Datos del post no v\xe1lidos:",t.errors),Error("Datos del post no v\xe1lidos: ".concat(t.errors.join(", ")));let r=t.sanitizedData;if(!r)throw Error("Error en la validaci\xf3n de datos del post");return await c(async()=>{let t=await (0,a.gS)((0,a.rJ)(s.db,"feedPosts"),{...e,content:r.content,images:r.images||e.images||[],createdAt:(0,a.O5)(),updatedAt:(0,a.O5)(),likes:0,comments:0,shares:0,likedBy:[],sharedBy:[],interactions:[],commentsList:[]});return{success:!0,id:t.id}},"createFeedPost")}catch(r){console.error("❌ Database: Error creating feed post:",r);let t=n.$2.postCreate(e.author.id,{...e,content:e.content,images:e.images||[]},"medium");return console.log("\uD83D\uDD04 Database: Post agregado a cola de reintentos: ".concat(t)),{success:!0,id:"offline_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),retryId:t}}},J=async()=>{try{let e=(0,a.rJ)(s.db,"subscriptions"),t=(0,a.P)(e,(0,a.My)("createdAt","desc"));return(await (0,a.GG)(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting all subscriptions:",e),[]}},I=async e=>{try{let t=(0,a.rJ)(s.db,"adminWithdrawals"),r=await (0,a.gS)(t,{...e,requestedAt:(0,a.O5)()});return{success:!0,id:r.id}}catch(e){return console.error("Error creating admin withdrawal:",e),{success:!1,error:e}}},G=async()=>{try{let e=(0,a.rJ)(s.db,"adminWithdrawals"),t=(0,a.P)(e,(0,a.My)("requestedAt","desc"));return(await (0,a.GG)(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting admin withdrawals:",e),[]}},B=async(e,t)=>{try{let r=(0,a.H9)(s.db,"adminWithdrawals",e),o={status:t,updatedAt:(0,a.O5)()};return"completed"===t&&(o.completedAt=(0,a.O5)()),await (0,a.mZ)(r,o),{success:!0}}catch(e){return console.error("Error updating withdrawal status:",e),{success:!1,error:e}}},R=async()=>{try{let e=(0,a.rJ)(s.db,"subscriptions"),t=(0,a.P)(e,(0,a._M)("grantedByAdmin","!=",!0)),r=(await (0,a.GG)(t)).docs.map(e=>e.data());return{totalSubscriptions:r.length,activeSubscriptions:r.filter(e=>"active"===e.status).length,totalRevenue:0}}catch(e){return console.error("Error getting subscription revenue:",e),{totalSubscriptions:0,activeSubscriptions:0,totalRevenue:0}}},k=async e=>{try{let t=await (0,a.gS)((0,a.rJ)(s.db,"subscriptions"),{...e,createdAt:(0,a.O5)(),updatedAt:(0,a.O5)()});return{success:!0,id:t.id}}catch(e){return console.error("Error creating subscription:",e),{success:!1,error:"Failed to create subscription"}}},z=async(e,t,r)=>{try{let a={userId:e,planId:t,status:"active",startDate:new Date().toISOString(),endDate:new Date(Date.now()+24*r*36e5).toISOString(),paymentMethod:"stripe",isFreeTrial:!0,grantedByAdmin:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await k(a)}catch(e){return console.error("Error granting free subscription:",e),{success:!1,error:"Failed to grant free subscription"}}},j=async(e,t,r)=>{try{return await (0,a.mZ)((0,a.H9)(s.db,"tournaments",e,"registrations",t),{status:r,updatedAt:(0,a.O5)()}),{success:!0}}catch(e){return console.error("Error updating registration status:",e),{success:!1,error:"Failed to update registration status"}}}}}]);