(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[27,4260],{22424:(e,a,t)=>{"use strict";t.d(a,{Ds:()=>x,Hv:()=>h,Jv:()=>u,Ss:()=>l,bA:()=>d,hR:()=>p,mT:()=>f,ul:()=>m});var r=t(56104),s=t(35317),n=t(6033),i=t(68598);async function c(e){try{let a=(0,i.Ip)(e);if(!a.isValid)return{success:!1,error:a.errors.join(", ")};let t={...e,createdAt:new Date,expiresAt:e.expiresAt||new Date(Date.now()+6048e5)},n=await (0,s.gS)((0,s.rJ)(r.db,"notifications"),t),c=(0,s.P)((0,s.rJ)(r.db,"notificationSubscriptions"),(0,s._M)("userId","==",e.userId),(0,s._M)("active","==",!0)),l=(await (0,s.GG)(c)).docs.map(async e=>{let a=e.data();try{await o(a,t)}catch(a){console.error("Error sending to device:",a),await (0,s.mZ)((0,s.H9)(r.db,"notificationSubscriptions",e.id),{active:!1})}});return await Promise.allSettled(l),{success:!0,notificationId:n.id}}catch(t){console.error("Error sending push notification:",t);let a=n.$2.messageSend(e.userId,{operation:"sendPushNotification",notification:e},"high"===e.priority?"high":"medium");return{success:!1,error:t instanceof Error?t.message:"Unknown error",retryId:a}}}async function o(e,a){console.log("Sending notification to device:",{endpoint:e.endpoint,notification:{title:a.title,body:a.body,data:a.data}}),await new Promise(e=>setTimeout(e,100))}async function l(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{let n=(0,s.P)((0,s.rJ)(r.db,"notifications"),(0,s._M)("userId","==",e),(0,s.My)("createdAt","desc"),(0,s.AB)(a));t&&(n=(0,s.P)((0,s.rJ)(r.db,"notifications"),(0,s._M)("userId","==",e),(0,s._M)("read","==",!1),(0,s.My)("createdAt","desc"),(0,s.AB)(a)));let i=(await (0,s.GG)(n)).docs.map(e=>({id:e.id,...e.data()}));return{success:!0,notifications:i}}catch(e){return console.error("Error getting user notifications:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function d(e){try{return await (0,s.mZ)((0,s.H9)(r.db,"notifications",e),{read:!0}),{success:!0}}catch(t){console.error("Error marking notification as read:",t);let a=n.$2.messageSend("system",{operation:"markNotificationAsRead",notificationId:e},"low");return{success:!1,error:t instanceof Error?t.message:"Unknown error",retryId:a}}}function u(e,a){let t=(0,s.P)((0,s.rJ)(r.db,"notifications"),(0,s._M)("userId","==",e),(0,s.My)("createdAt","desc"),(0,s.AB)(50));return(0,s.aQ)(t,e=>{a(e.docs.map(e=>({id:e.id,...e.data()})))})}async function m(e){try{let a=(0,s.P)((0,s.rJ)(r.db,"notifications"),(0,s._M)("userId","==",e),(0,s._M)("read","==",!1)),t=await (0,s.GG)(a);return{success:!0,count:t.size}}catch(e){return console.error("Error getting unread notification count:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function h(e,a,t,r){return c({userId:e,type:"message",title:"Nuevo mensaje de ".concat(a),body:t,data:{chatId:r,type:"message"},read:!1,priority:"high",actionUrl:"/chats/".concat(r)})}async function p(e,a,t){return c({userId:e,type:"friend_request",title:"Nueva solicitud de amistad",body:"".concat(a," te ha enviado una solicitud de amistad"),data:{senderId:t,type:"friend_request"},read:!1,priority:"normal",actionUrl:"/friends"})}async function x(e,a,t,r){try{let s,n,i="normal";switch(t){case"registered":s="Registro confirmado",n="Te has registrado exitosamente en ".concat(a);break;case"waitlisted":s="En lista de espera",n="Has sido agregado a la lista de espera de ".concat(a);break;case"moved-from-waitlist":s="\xa1Registro confirmado!",n="Has sido movido de la lista de espera a participante activo en ".concat(a),i="high";break;case"tournament-starting":s="Torneo iniciando",n="".concat(a," est\xe1 a punto de comenzar"),i="high";break;case"tournament-cancelled":s="Torneo cancelado",n="".concat(a," ha sido cancelado"),i="high";break;default:s="Actualizaci\xf3n de torneo",n="Hay una actualizaci\xf3n sobre ".concat(a)}return await c({userId:e,type:"tournament_invite",title:s,body:n,priority:i,read:!1,actionUrl:"/tournaments/".concat(r),data:{tournamentId:r,tournamentTitle:a,notificationType:t,type:"tournament"}})}catch(e){return console.error("Error sending tournament notification:",e),{success:!1,error:"Failed to send tournament notification"}}}async function f(){try{if(!("Notification"in window))return{success:!1,error:"Este navegador no soporta notificaciones"};if("granted"===Notification.permission)return{success:!0,permission:"granted"};let e=await Notification.requestPermission();return{success:"granted"===e,permission:e,error:"denied"===e?"Permisos de notificaci\xf3n denegados":void 0}}catch(e){return console.error("Error requesting notification permission:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}},44838:(e,a,t)=>{"use strict";t.d(a,{I:()=>m,SQ:()=>h,_2:()=>p,lp:()=>x,mB:()=>f,rI:()=>d,ty:()=>u});var r=t(95155),s=t(12115),n=t(76215),i=t(73158),c=t(10518),o=t(70154),l=t(59434);let d=n.bL,u=n.l9,m=n.YJ;n.ZL,n.Pb,n.z6,s.forwardRef((e,a)=>{let{className:t,inset:s,children:c,...o}=e;return(0,r.jsxs)(n.ZP,{ref:a,className:(0,l.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s&&"pl-8",t),...o,children:[c,(0,r.jsx)(i.A,{className:"ml-auto"})]})}).displayName=n.ZP.displayName,s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,r.jsx)(n.G5,{ref:a,className:(0,l.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...s})}).displayName=n.G5.displayName;let h=s.forwardRef((e,a)=>{let{className:t,sideOffset:s=4,...i}=e;return(0,r.jsx)(n.ZL,{children:(0,r.jsx)(n.UC,{ref:a,sideOffset:s,className:(0,l.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...i})})});h.displayName=n.UC.displayName;let p=s.forwardRef((e,a)=>{let{className:t,inset:s,...i}=e;return(0,r.jsx)(n.q7,{ref:a,className:(0,l.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s&&"pl-8",t),...i})});p.displayName=n.q7.displayName,s.forwardRef((e,a)=>{let{className:t,children:s,checked:i,...o}=e;return(0,r.jsxs)(n.H_,{ref:a,className:(0,l.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:i,...o,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(n.VF,{children:(0,r.jsx)(c.A,{className:"h-4 w-4"})})}),s]})}).displayName=n.H_.displayName,s.forwardRef((e,a)=>{let{className:t,children:s,...i}=e;return(0,r.jsxs)(n.hN,{ref:a,className:(0,l.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...i,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(n.VF,{children:(0,r.jsx)(o.A,{className:"h-2 w-2 fill-current"})})}),s]})}).displayName=n.hN.displayName;let x=s.forwardRef((e,a)=>{let{className:t,inset:s,...i}=e;return(0,r.jsx)(n.JU,{ref:a,className:(0,l.cn)("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",t),...i})});x.displayName=n.JU.displayName;let f=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,r.jsx)(n.wv,{ref:a,className:(0,l.cn)("-mx-1 my-1 h-px bg-muted",t),...s})});f.displayName=n.wv.displayName},66424:(e,a,t)=>{"use strict";t.d(a,{F:()=>c});var r=t(95155),s=t(12115),n=t(47655),i=t(59434);let c=s.forwardRef((e,a)=>{let{className:t,children:s,...c}=e;return(0,r.jsxs)(n.bL,{ref:a,className:(0,i.cn)("relative overflow-hidden",t),...c,children:[(0,r.jsx)(n.LM,{className:"h-full w-full rounded-[inherit]",children:s}),(0,r.jsx)(o,{}),(0,r.jsx)(n.OK,{})]})});c.displayName=n.bL.displayName;let o=s.forwardRef((e,a)=>{let{className:t,orientation:s="vertical",...c}=e;return(0,r.jsx)(n.VM,{ref:a,orientation:s,className:(0,i.cn)("flex touch-none select-none transition-colors","vertical"===s&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...c,children:(0,r.jsx)(n.lr,{className:"relative flex-1 rounded-full bg-border"})})});o.displayName=n.VM.displayName},68736:(e,a,t)=>{Promise.resolve().then(t.bind(t,69692))},69692:(e,a,t)=>{"use strict";t.d(a,{default:()=>ey});var r=t(95155),s=t(12115),n=t(91394),i=t(30285),c=t(66695),o=t(62523),l=t(93473),d=t(35317),u=t(56104),m=t(68598),h=t(6033),p=t(22424);let x=new Map,f=new Map,g=new Map,v=(e,a)=>{let t=x.get("messages_".concat(e));t&&t();let r=(0,d.rJ)(u.db,"chats",e,"messages"),s=(0,d.P)(r,(0,d.My)("timestamp","asc")),n=(0,d.aQ)(s,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),a(t)},e=>{console.error("Error listening to messages:",e),a([])});return x.set("messages_".concat(e),n),f.set(e,a),n},j=async(e,a,t)=>{try{let s=(0,m.ue)({...t,sender:a,timestamp:new Date});if(!s.isValid)throw console.error("Message validation failed:",s.errors),Error("Invalid message: ".concat(s.errors.join(", ")));let n=s.sanitizedData,i={...n,senderId:a,timestamp:(0,d.O5)()},c=(0,d.rJ)(u.db,"chats",e,"messages"),o=await (0,d.gS)(c,i),l=(0,d.H9)(u.db,"chats",e);await (0,d.mZ)(l,{lastMessage:n.content,lastMessageSender:a,lastMessageTimestamp:(0,d.O5)(),updatedAt:(0,d.O5)()});try{let t=await (0,d.x7)(l);if(t.exists()){var r;let s=(null==(r=t.data().participants)?void 0:r.filter(e=>e!==a))||[],i=n.content||n.text||"",c=i.length>50?i.substring(0,50)+"...":i;for(let a of s)await (0,p.Hv)(a,"Usuario",c,e)}}catch(e){console.error("Error sending push notification:",e)}return{success:!0,id:o.id}}catch(r){return console.error("Error sending message:",r),{success:!1,error:r,retryId:h.$2.messageSend(a,{chatId:e,message:t},"high")}}},b=new Map,N=new Map,w=async(e,a,t)=>{try{b.has(e)||b.set(e,new Set);let r=b.get(e);if(t){r.add(a);let t=N.get("".concat(e,"_").concat(a));t&&clearTimeout(t);let s=setTimeout(()=>{r.delete(a),N.delete("".concat(e,"_").concat(a)),k(e)},5e3);N.set("".concat(e,"_").concat(a),s)}else{r.delete(a);let t=N.get("".concat(e,"_").concat(a));t&&(clearTimeout(t),N.delete("".concat(e,"_").concat(a)))}return k(e),{success:!0}}catch(e){return console.error("Error setting typing indicator:",e),{success:!1,error:e}}},y=new Map,A=(e,a)=>(y.set(e,a),()=>{y.delete(e)}),k=e=>{let a=y.get(e);a&&a(Array.from(b.get(e)||[]))},S=()=>{x.forEach(e=>{e()}),x.clear(),f.clear(),g.clear(),y.clear(),N.forEach(e=>{clearTimeout(e)}),N.clear(),b.clear()},E=navigator.onLine,C=new Set;window.addEventListener("online",()=>{E=!0,C.forEach(e=>e(!0))}),window.addEventListener("offline",()=>{E=!1,C.forEach(e=>e(!1))});let R=e=>(C.add(e),e(E),()=>{C.delete(e)});var L=t(12543),T=t(31554),z=t(81008),I=t(53764),U=t(13300),M=t(75066),_=t(67933),O=t(79311),D=t(2448),P=t(91721),B=t(24037),$=t(6273),F=t(73672),G=t(44838),V=t(66424),H=t(54165),q=t(95120),Z=t(36936),J=t(68027),Q=t(87824),W=t(16610),Y=t(82733),K=t(18553),X=t(73503),ee=t(16923);let ea=[{name:"Default",value:"bg-chat-default",icon:q.A},{name:"Tema Claro",value:"bg-chat-light",icon:Z.A},{name:"Tema Oscuro",value:"bg-chat-dark",icon:J.A}],et=[{name:"Erangel",value:"bg-chat-erangel",icon:Q.A},{name:"Miramar",value:"bg-chat-miramar",icon:Q.A},{name:"Sanhok",value:"bg-chat-sanhok",icon:Q.A},{name:"Vikendi",value:"bg-chat-vikendi",icon:W.A},{name:"Livik",value:"bg-chat-livik",icon:Q.A},{name:"Rondo",value:"bg-chat-rondo",icon:Q.A}],er=[{name:"Mosaico de Skins",value:"bg-chat-skin-mosaic",icon:O.A},{name:"Camuflaje Digital",value:"bg-chat-camo",icon:Y.A},{name:"Neon Punk",value:"bg-chat-neon",icon:K.A},{name:"Blood Raven",value:"bg-chat-raven",icon:X.A}];function es(e){let{children:a,setTheme:t,onUploadClick:s}=e;return(0,r.jsxs)(G.rI,{children:[(0,r.jsx)(G.ty,{asChild:!0,children:a}),(0,r.jsxs)(G.SQ,{align:"end",className:"w-60",children:[(0,r.jsx)(G.lp,{children:"Fondos de Chat"}),(0,r.jsx)(G.mB,{}),(0,r.jsx)(G.I,{children:(0,r.jsxs)(G._2,{onClick:s,children:[(0,r.jsx)(ee.A,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Subir Fondo Personalizado"})]})}),(0,r.jsx)(G.mB,{}),(0,r.jsxs)(G.I,{children:[(0,r.jsx)(G.lp,{className:"text-xs font-semibold text-muted-foreground px-2",children:"General"}),ea.map(e=>(0,r.jsxs)(G._2,{onClick:()=>t(e.value),children:[(0,r.jsx)(e.icon,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:e.name})]},e.value))]}),(0,r.jsx)(G.mB,{}),(0,r.jsxs)(G.I,{children:[(0,r.jsx)(G.lp,{className:"text-xs font-semibold text-muted-foreground px-2",children:"Mapas"}),et.map(e=>(0,r.jsxs)(G._2,{onClick:()=>t(e.value),children:[(0,r.jsx)(e.icon,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:e.name})]},e.value))]}),(0,r.jsx)(G.mB,{}),(0,r.jsxs)(G.I,{children:[(0,r.jsx)(G.lp,{className:"text-xs font-semibold text-muted-foreground px-2",children:"Temas de Skins"}),er.map(e=>(0,r.jsxs)(G._2,{onClick:()=>t(e.value),children:[(0,r.jsx)(e.icon,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:e.name})]},e.value))]})]})]})}var en=t(30411),ei=t(7149),ec=t(77223),eo=t(87481);function el(e){let{onSendVoiceMessage:a,maxDuration:t=60,className:n}=e,{permissions:o,requestMicrophonePermission:l}=(0,en.S)(),{toast:d}=(0,eo.dj)(),[u,m]=(0,s.useState)(!1),[h,p]=(0,s.useState)(!1),[x,f]=(0,s.useState)(0),[g,v]=(0,s.useState)(null),[j,b]=(0,s.useState)(null),N=(0,s.useRef)(null),w=(0,s.useRef)(null),y=(0,s.useRef)(null),A=(0,s.useRef)(null),k=(0,s.useRef)([]);(0,s.useEffect)(()=>()=>{A.current&&clearInterval(A.current),y.current&&y.current.getTracks().forEach(e=>e.stop()),j&&URL.revokeObjectURL(j)},[j]);let S=async()=>{if(!o.microphone&&!await l())return void d({title:"Permiso denegado",description:"No se puede grabar sin permisos de micr\xf3fono.",variant:"destructive"});try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});y.current=e;let a=new MediaRecorder(e);N.current=a,k.current=[],a.ondataavailable=e=>{e.data.size>0&&k.current.push(e.data)},a.onstop=()=>{let a=new Blob(k.current,{type:"audio/webm"});v(a),j&&URL.revokeObjectURL(j);let t=URL.createObjectURL(a);b(t),e.getTracks().forEach(e=>e.stop())},a.start(),m(!0),f(0),A.current=setInterval(()=>{f(e=>{let a=e+1;return a>=t&&E(),a})},1e3),d({title:"Grabaci\xf3n iniciada",description:"Habla ahora para grabar tu mensaje de voz."})}catch(e){console.error("Error starting recording:",e),d({title:"Error de grabaci\xf3n",description:"No se pudo iniciar la grabaci\xf3n.",variant:"destructive"})}},E=()=>{N.current&&u&&(N.current.stop(),m(!1),A.current&&(clearInterval(A.current),A.current=null),d({title:"Grabaci\xf3n completada",description:"Tu mensaje de voz est\xe1 listo."}))},C=()=>{j&&URL.revokeObjectURL(j),b(null),v(null),f(0),w.current&&(w.current.pause(),p(!1)),d({title:"Grabaci\xf3n eliminada",description:"La grabaci\xf3n ha sido eliminada."})},R=e=>Math.floor(e/60)+":"+(e%60).toString().padStart(2,"0");return(0,r.jsx)(c.Zp,{className:n,children:(0,r.jsx)(c.Wu,{className:"p-4",children:(0,r.jsxs)("div",{className:"space-y-4",children:[g?(0,r.jsx)("div",{className:"space-y-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)(i.$,{size:"sm",variant:"outline",onClick:h?()=>{w.current&&h&&(w.current.pause(),p(!1))}:()=>{if(j&&!h){let e=new Audio(j);w.current=e,e.onended=()=>{p(!1)},e.play(),p(!0)}},children:h?(0,r.jsx)(I.A,{className:"h-4 w-4"}):(0,r.jsx)(U.A,{className:"h-4 w-4"})}),(0,r.jsx)("div",{className:"text-sm font-mono",children:R(x)})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)(i.$,{size:"sm",variant:"outline",onClick:C,children:(0,r.jsx)(ec.A,{className:"h-4 w-4"})}),(0,r.jsx)(i.$,{size:"sm",onClick:()=>{g&&a&&(a(g,x),C(),d({title:"Mensaje enviado",description:"Tu mensaje de voz ha sido enviado."}))},children:(0,r.jsx)(F.A,{className:"h-4 w-4"})})]})]})}):(0,r.jsxs)("div",{className:"text-center space-y-4",children:[(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)(i.$,{size:"lg",variant:u?"destructive":"default",className:"h-16 w-16 rounded-full ".concat(u?"animate-pulse bg-red-500 hover:bg-red-600":""),onClick:u?E:S,disabled:!o.microphone&&!u,children:u?(0,r.jsx)(ei.A,{className:"h-8 w-8"}):(0,r.jsx)($.A,{className:"h-8 w-8"})})}),u&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"text-lg font-mono text-red-500",children:R(x)}),(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:["M\xe1ximo: ",R(t)]}),(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,r.jsx)("div",{className:"bg-red-500 h-2 rounded-full transition-all duration-1000",style:{width:"".concat(x/t*100,"%")}})})]}),!u&&(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:o.microphone?"Toca el micr\xf3fono para grabar":"Necesitas permitir el acceso al micr\xf3fono"})]}),!o.microphone&&!u&&(0,r.jsxs)("div",{className:"text-center space-y-2",children:[(0,r.jsx)("div",{className:"text-sm text-yellow-600",children:"Se requiere permiso de micr\xf3fono"}),(0,r.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>l(),className:"border-yellow-300 text-yellow-800 hover:bg-yellow-100",children:"Permitir Micr\xf3fono"})]})]})})})}var ed=t(8531),eu=t(50185),em=t(66766);function eh(e){let{onSendImage:a,className:t,maxWidth:n=1920,maxHeight:o=1080,quality:l=.8}=e,{permissions:d,requestCameraPermission:u,takePhoto:m}=(0,en.S)(),{toast:h}=(0,eo.dj)(),[p,x]=(0,s.useState)(!1),[f,g]=(0,s.useState)(null),[v,j]=(0,s.useState)(null),[b,N]=(0,s.useState)("environment"),w=(0,s.useRef)(null),y=(0,s.useRef)(null),A=(0,s.useRef)(null);(0,s.useEffect)(()=>()=>{A.current&&A.current.getTracks().forEach(e=>e.stop()),f&&URL.revokeObjectURL(f)},[f]);let k=async()=>{if(!d.camera&&!await u())return void h({title:"Permiso denegado",description:"No se puede acceder a la c\xe1mara sin permisos.",variant:"destructive"});try{let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:b,width:{ideal:n},height:{ideal:o}}});A.current=e,w.current&&(w.current.srcObject=e,w.current.play()),x(!0),h({title:"C\xe1mara activada",description:"La c\xe1mara est\xe1 lista para tomar fotos."})}catch(e){console.error("Error accessing camera:",e),h({title:"Error de c\xe1mara",description:"No se pudo acceder a la c\xe1mara. Verifica los permisos.",variant:"destructive"})}},S=()=>{A.current&&(A.current.getTracks().forEach(e=>e.stop()),A.current=null),w.current&&(w.current.srcObject=null),x(!1)},E=async()=>{try{let e=await m();if(e&&e.webPath){let a=await fetch(e.webPath),t=await a.blob();j(t),g(e.webPath),h({title:"Foto capturada",description:"La imagen ha sido capturada con la c\xe1mara nativa."})}}catch(e){console.error("Error taking photo with Capacitor:",e),h({title:"Error de c\xe1mara",description:"No se pudo tomar la foto con la c\xe1mara nativa.",variant:"destructive"})}},C=()=>{f&&URL.revokeObjectURL(f),g(null),j(null),h({title:"Imagen eliminada",description:"La imagen capturada ha sido eliminada."})};return(0,r.jsx)(c.Zp,{className:t,children:(0,r.jsxs)(c.Wu,{className:"p-4",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[p&&(0,r.jsxs)("div",{className:"relative aspect-video bg-black rounded-lg overflow-hidden",children:[(0,r.jsx)("video",{ref:w,className:"w-full h-full object-cover",autoPlay:!0,playsInline:!0,muted:!0}),(0,r.jsxs)("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-2",children:[(0,r.jsx)(i.$,{onClick:()=>{N(e=>"user"===e?"environment":"user"),p&&(S(),setTimeout(()=>{k()},100))},variant:"secondary",size:"sm",className:"bg-black/50 text-white hover:bg-black/70",children:(0,r.jsx)(ed.A,{className:"h-4 w-4"})}),(0,r.jsxs)(i.$,{onClick:()=>{if(!w.current||!y.current)return;let e=w.current,a=y.current,t=a.getContext("2d");t&&(a.width=e.videoWidth,a.height=e.videoHeight,t.drawImage(e,0,0,a.width,a.height),a.toBlob(e=>{e&&(j(e),f&&URL.revokeObjectURL(f),g(URL.createObjectURL(e)),S(),h({title:"Foto capturada",description:"La imagen ha sido capturada exitosamente."}))},"image/jpeg",l))},size:"sm",className:"bg-white text-black hover:bg-gray-100",children:[(0,r.jsx)(_.A,{className:"h-4 w-4 mr-2"}),"Capturar"]}),(0,r.jsx)(i.$,{onClick:S,variant:"destructive",size:"sm",children:(0,r.jsx)(eu.A,{className:"h-4 w-4"})})]})]}),f&&(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("div",{className:"relative aspect-video bg-gray-100 rounded-lg overflow-hidden",children:(0,r.jsx)(em.default,{src:f,alt:"Imagen capturada",fill:!0,className:"object-cover"})}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(i.$,{variant:"outline",size:"sm",onClick:C,className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[(0,r.jsx)(ec.A,{className:"h-4 w-4 mr-2"}),"Eliminar"]}),(0,r.jsxs)(i.$,{onClick:()=>{v&&f&&a&&(a(v,f),C(),h({title:"Imagen enviada",description:"Tu imagen ha sido enviada al chat."}))},size:"sm",className:"flex-1 bg-green-600 hover:bg-green-700 text-white",children:[(0,r.jsx)(F.A,{className:"h-4 w-4 mr-2"}),"Enviar Imagen"]})]})]}),!p&&!f&&(0,r.jsx)("div",{className:"space-y-2",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-2",children:[(0,r.jsxs)(i.$,{onClick:k,disabled:!d.camera,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[(0,r.jsx)(_.A,{className:"h-4 w-4 mr-2"}),"Abrir C\xe1mara"]}),(0,r.jsxs)(i.$,{onClick:E,disabled:!d.camera,variant:"outline",children:[(0,r.jsx)(_.A,{className:"h-4 w-4 mr-2"}),"C\xe1mara Nativa"]}),(0,r.jsxs)(i.$,{onClick:()=>{let e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{var a;let t=null==(a=e.target.files)?void 0:a[0];t&&(j(t),f&&URL.revokeObjectURL(f),g(URL.createObjectURL(t)),h({title:"Imagen seleccionada",description:"La imagen ha sido seleccionada de la galer\xeda."}))},e.click()},variant:"outline",children:[(0,r.jsx)(O.A,{className:"h-4 w-4 mr-2"}),"Seleccionar de Galer\xeda"]})]})}),!d.camera&&(0,r.jsx)("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)(_.A,{className:"h-4 w-4 text-yellow-600 mt-0.5"}),(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsx)("p",{className:"font-medium text-yellow-800",children:"Permiso de c\xe1mara requerido"}),(0,r.jsx)("p",{className:"text-yellow-700 mt-1",children:"Para tomar fotos y enviar im\xe1genes, necesitas permitir el acceso a la c\xe1mara."}),(0,r.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>u(),className:"mt-2 border-yellow-300 text-yellow-800 hover:bg-yellow-100",children:"Permitir C\xe1mara"})]})]})})]}),(0,r.jsx)("canvas",{ref:y,className:"hidden"})]})})}var ep=t(36190),ex=t(60620),ef=t(57789);function eg(e){let{isOpen:a,onClose:t,contactName:o,contactAvatar:l,isIncoming:d=!1,onAnswer:u,onDecline:m}=e,[h,p]=(0,s.useState)(!1),[x,f]=(0,s.useState)(!1),[g,v]=(0,s.useState)(!1),[j,b]=(0,s.useState)(0),[N,w]=(0,s.useState)(!1),{toast:y}=(0,eo.dj)(),A=(0,s.useRef)(null),k=(0,s.useRef)(null),S=(0,s.useRef)(null),E=(0,s.useRef)(null),C=(0,s.useRef)(null);(0,s.useEffect)(()=>(h&&null===C.current&&(C.current=setInterval(()=>{b(e=>e+1)},1e3)),()=>{C.current&&(clearInterval(C.current),C.current=null)}),[h]),(0,s.useEffect)(()=>(a||M(),()=>{M()}),[a]);let R=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw Error("Tu navegador no soporta acceso al micr\xf3fono");let e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:44100,channelCount:1}});return E.current=e,e}catch(a){console.error("Error accessing microphone:",a);let e="No se pudo acceder al micr\xf3fono. Verifica los permisos.";throw"NotAllowedError"===a.name?e="Permisos de micr\xf3fono denegados. Por favor, permite el acceso al micr\xf3fono en la configuraci\xf3n del navegador.":"NotFoundError"===a.name?e="No se encontr\xf3 ning\xfan micr\xf3fono. Verifica que tu dispositivo tenga un micr\xf3fono conectado.":"NotReadableError"===a.name&&(e="El micr\xf3fono est\xe1 siendo usado por otra aplicaci\xf3n. Cierra otras aplicaciones que puedan estar usando el micr\xf3fono."),y({title:"Error de Micr\xf3fono",description:e,variant:"destructive"}),a}},L=async()=>{try{if(!window.RTCPeerConnection)throw Error("Tu navegador no soporta llamadas de voz (WebRTC no disponible)");let e=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"}],iceCandidatePoolSize:10,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});S.current=e;let a=await R();return a.getTracks().forEach(t=>{e.addTrack(t,a)}),e.onicecandidate=e=>{e.candidate&&console.log("ICE candidate:",e.candidate)},e.ontrack=e=>{console.log("Received remote stream"),k.current&&e.streams[0]&&(k.current.srcObject=e.streams[0])},e.onconnectionstatechange=()=>{console.log("Connection state:",e.connectionState),"connected"===e.connectionState?(p(!0),w(!1),y({title:"Llamada Conectada",description:"La llamada se ha establecido correctamente.",variant:"default"})):("disconnected"===e.connectionState||"failed"===e.connectionState)&&(y({title:"Llamada Desconectada",description:"La llamada se ha desconectado.",variant:"destructive"}),U())},e.onicegatheringstatechange=()=>{console.log("ICE gathering state:",e.iceGatheringState)},e}catch(e){throw console.error("Error initializing peer connection:",e),y({title:"Error de Conexi\xf3n",description:e.message||"No se pudo establecer la conexi\xf3n de llamada.",variant:"destructive"}),e}},z=async()=>{try{w(!0),await L(),setTimeout(()=>{var e;(null==(e=S.current)?void 0:e.connectionState)!=="connected"&&(p(!0),w(!1),y({title:"Llamada Conectada",description:"Llamada de audio con ".concat(o," iniciada.")}))},2e3),null==u||u()}catch(e){console.error("Error answering call:",e),w(!1),y({title:"Error al Responder",description:"No se pudo responder la llamada. Intenta nuevamente.",variant:"destructive"})}},I=async()=>{try{w(!0),await L(),setTimeout(()=>{var e;(null==(e=S.current)?void 0:e.connectionState)!=="connected"&&(p(!0),w(!1),y({title:"Llamada Iniciada",description:"Llamando a ".concat(o,"...")}))},3e3)}catch(e){console.error("Error starting call:",e),w(!1),y({title:"Error al Iniciar Llamada",description:"No se pudo iniciar la llamada. Verifica tu conexi\xf3n y permisos.",variant:"destructive"})}},U=()=>{try{M(),y({title:"Llamada Finalizada",description:"La llamada ha terminado.",variant:"default"})}catch(e){console.error("Error ending call:",e)}finally{t()}},M=()=>{try{E.current&&(E.current.getTracks().forEach(e=>{e.stop(),console.log("Stopped local track:",e.kind)}),E.current=null),S.current&&(S.current.getSenders().forEach(e=>{e.track&&e.track.stop()}),S.current.close(),S.current=null,console.log("Peer connection closed")),C.current&&(clearInterval(C.current),C.current=null),A.current&&(A.current.srcObject=null),k.current&&(k.current.srcObject=null),p(!1),w(!1),b(0),f(!1),v(!1),console.log("Call cleanup completed")}catch(e){console.error("Error during cleanup:",e)}};return a?(0,r.jsxs)("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",children:[(0,r.jsx)(c.Zp,{className:"w-full max-w-md mx-4",children:(0,r.jsxs)(c.Wu,{className:"p-8 text-center space-y-6",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)(n.eu,{className:"w-24 h-24 mx-auto",children:[(0,r.jsx)(n.BK,{src:l}),(0,r.jsx)(n.q5,{className:"text-2xl",children:o.charAt(0).toUpperCase()})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-xl font-semibold",children:o}),N&&(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:d?"Conectando...":"Llamando..."}),h&&(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:(e=>{let a=Math.floor(e/60);return"".concat(a.toString().padStart(2,"0"),":").concat((e%60).toString().padStart(2,"0"))})(j)}),!h&&!N&&d&&(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Llamada entrante"})]})]}),(0,r.jsx)("div",{className:"flex justify-center space-x-4",children:!d||h||N?h?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.$,{size:"lg",variant:x?"destructive":"secondary",className:"rounded-full w-12 h-12",onClick:()=>{E.current&&(E.current.getAudioTracks().forEach(e=>{e.enabled=x}),f(!x))},children:x?(0,r.jsx)(ei.A,{className:"h-5 w-5"}):(0,r.jsx)($.A,{className:"h-5 w-5"})}),(0,r.jsx)(i.$,{size:"lg",variant:g?"default":"secondary",className:"rounded-full w-12 h-12",onClick:()=>{v(!g)},children:g?(0,r.jsx)(ex.A,{className:"h-5 w-5"}):(0,r.jsx)(ef.A,{className:"h-5 w-5"})}),(0,r.jsx)(i.$,{size:"lg",variant:"destructive",className:"rounded-full w-14 h-14",onClick:U,children:(0,r.jsx)(ep.A,{className:"h-6 w-6"})})]}):(0,r.jsxs)(r.Fragment,{children:[!N&&(0,r.jsx)(i.$,{size:"lg",className:"rounded-full w-14 h-14 bg-green-600 hover:bg-green-700",onClick:I,children:(0,r.jsx)(T.A,{className:"h-6 w-6"})}),(0,r.jsx)(i.$,{size:"lg",variant:"destructive",className:"rounded-full w-14 h-14",onClick:U,children:(0,r.jsx)(ep.A,{className:"h-6 w-6"})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.$,{size:"lg",variant:"destructive",className:"rounded-full w-14 h-14",onClick:()=>{try{M(),y({title:"Llamada Rechazada",description:"Has rechazado la llamada.",variant:"default"})}catch(e){console.error("Error declining call:",e)}finally{null==m||m(),t()}},children:(0,r.jsx)(ep.A,{className:"h-6 w-6"})}),(0,r.jsx)(i.$,{size:"lg",className:"rounded-full w-14 h-14 bg-green-600 hover:bg-green-700",onClick:z,children:(0,r.jsx)(T.A,{className:"h-6 w-6"})})]})})]})}),(0,r.jsx)("audio",{ref:A,muted:!0}),(0,r.jsx)("audio",{ref:k,autoPlay:!0})]}):null}var ev=t(89067),ej=t(59434),eb=t(35695),eN=t(6874),ew=t.n(eN);function ey(e){let{chatId:a}=e;(0,eb.useRouter)();let{toast:t}=(0,eo.dj)(),{permissions:d,requestAllPermissions:u}=(0,en.S)(),[m,h]=(0,s.useState)(l.VY),[p,x]=(0,s.useState)([]),[f,g]=(0,s.useState)([]),[b,N]=(0,s.useState)(!0),[y,k]=(0,s.useState)(null),[E,C]=(0,s.useState)(!0),[q,Z]=(0,s.useState)(""),[J,Q]=(0,s.useState)(!1),[W,Y]=(0,s.useState)(!1),[K,X]=(0,s.useState)(!1),ee=(0,s.useRef)(null),[ea,et]=(0,s.useState)("bg-chat-default"),[er,ei]=(0,s.useState)(null),ec=(0,s.useRef)(null),[ed,eu]=(0,s.useState)(!1),[ep,ex]=(0,s.useState)(!1),[ef,eN]=(0,s.useState)(null),[ey,eA]=(0,s.useState)(!1),ek=(0,s.useRef)(null),eS=(0,s.useRef)(null),eE=m.find(e=>e.id===a);(0,s.useEffect)(()=>{if(!a)return;C(!0);let e=v(a,e=>{x(e),C(!1)}),r=A(a,e=>{g(e)}),s=R(e=>{N(e),e?t({title:"Conectado",description:"Conexi\xf3n restablecida"}):t({title:"Sin conexi\xf3n",description:"Trabajando en modo offline",variant:"destructive"})});return()=>{e(),r(),s()}},[a,t]),(0,s.useEffect)(()=>()=>{ek.current&&(ek.current.pause(),ek.current=null),eS.current&&(URL.revokeObjectURL(eS.current),eS.current=null)},[]);let eC=async()=>{if(!a)return;y&&clearTimeout(y),await w(a,"current-user-id",!0);let e=setTimeout(async()=>{await w(a,"current-user-id",!1),k(null)},3e3);k(e)};(0,s.useEffect)(()=>()=>{y&&clearTimeout(y),S()},[y]);let eR=async()=>{try{let e=new Audio("data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT");e.volume=0,await e.play(),e.pause(),eA(!0),t({title:"Audio habilitado",description:"Ahora puedes reproducir mensajes de voz."})}catch(e){console.error("Error enabling audio context:",e)}},eL=async e=>{if(e.preventDefault(),q.trim()&&eE)try{await w(a,"current-user-id",!1),(await j(a,"current-user-id",{text:q,content:q,sender:"current-user-id"})).success?(Z(""),b?t({title:"Mensaje enviado",description:"Tu mensaje ha sido enviado correctamente."}):t({title:"Mensaje guardado",description:"Se enviar\xe1 cuando recuperes la conexi\xf3n."})):t({title:"Error",description:"No se pudo enviar el mensaje. Se reintentar\xe1 autom\xe1ticamente.",variant:"destructive"})}catch(e){console.error("Error sending message:",e),t({title:"Error",description:"No se pudo enviar el mensaje. Int\xe9ntalo de nuevo.",variant:"destructive"})}},eT=async e=>{if(!e.audioBlob)return void t({title:"Error",description:"No hay audio disponible para reproducir.",variant:"destructive"});if(!ey&&/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return void t({title:"Habilitar audio",description:"Toca 'Habilitar Audio' para reproducir mensajes de voz.",variant:"default"});if(window.confirm("\xbfDeseas reproducir este mensaje de voz de ".concat((null==eE?void 0:eE.name)||"Usuario","?"))){if(ef===e.id){ek.current&&(ek.current.pause(),eN(null));return}ek.current&&(ek.current.pause(),ek.current=null),eS.current&&(URL.revokeObjectURL(eS.current),eS.current=null);try{let a=URL.createObjectURL(e.audioBlob);eS.current=a;let r=new Audio;r.preload="auto",r.controls=!1,r.setAttribute("playsinline","true"),r.setAttribute("webkit-playsinline","true"),ek.current=r,eN(e.id),r.onloadstart=()=>{console.log("Audio loading started")},r.oncanplay=()=>{console.log("Audio can start playing")},r.onended=()=>{eN(null),eS.current&&(URL.revokeObjectURL(eS.current),eS.current=null),ek.current=null},r.onerror=e=>{console.error("Audio error:",e),eN(null),eS.current&&(URL.revokeObjectURL(eS.current),eS.current=null),ek.current=null,t({title:"Error de reproducci\xf3n",description:"No se pudo reproducir el mensaje de voz. Verifica que tu dispositivo soporte la reproducci\xf3n de audio.",variant:"destructive"})},r.onpause=()=>{ef===e.id&&eN(null)},r.src=a,await r.load();let s=r.play();void 0!==s&&await s}catch(e){console.error("Error playing audio:",e),eN(null),ek.current&&(ek.current=null),eS.current&&(URL.revokeObjectURL(eS.current),eS.current=null),t({title:"Error de reproducci\xf3n",description:"No se pudo reproducir el mensaje de voz. Intenta tocar la pantalla primero para habilitar el audio.",variant:"destructive"})}}},ez=(0,s.useRef)(null);return((0,s.useEffect)(()=>{ez.current&&ez.current.scrollIntoView({behavior:"smooth"})},[null==eE?void 0:eE.messages]),eE)?(0,r.jsxs)("div",{className:"h-[calc(100vh-120px)]",children:[(0,r.jsxs)(c.Zp,{className:"h-full flex flex-col overflow-hidden",children:[(0,r.jsxs)(c.aR,{className:"p-4 border-b flex flex-row items-center gap-3 z-10 bg-card/80 backdrop-blur-sm",children:[(0,r.jsx)(ew(),{href:"/chats",children:(0,r.jsxs)(i.$,{variant:"ghost",size:"sm",children:[(0,r.jsx)(L.A,{className:"h-4 w-4 mr-2"}),"Volver"]})}),(0,r.jsxs)(n.eu,{children:[(0,r.jsx)(n.BK,{src:eE.avatarUrl,alt:eE.name,"data-ai-hint":"gaming character"}),(0,r.jsx)(n.q5,{children:eE.name.substring(0,2)})]}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)(c.ZB,{children:eE.name}),(0,r.jsx)("p",{className:"text-xs text-green-500",children:"En l\xednea"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(i.$,{variant:"ghost",size:"icon",onClick:()=>eu(!0),children:(0,r.jsx)(T.A,{className:"h-5 w-5"})}),(0,r.jsx)("input",{type:"file",accept:"image/*",ref:ec,className:"hidden",onChange:e=>{var a;let t=null==(a=e.target.files)?void 0:a[0];if(t){let e=new FileReader;e.onload=e=>{var a;ei(null==(a=e.target)?void 0:a.result),et("")},e.readAsDataURL(t)}e.target.value=""}}),(0,r.jsx)(es,{setTheme:e=>{ei(null),et(e)},onUploadClick:()=>{var e;return null==(e=ec.current)?void 0:e.click()},children:(0,r.jsx)(i.$,{variant:"ghost",size:"icon",children:(0,r.jsx)(z.A,{className:"h-5 w-5"})})})]})]}),(0,r.jsxs)("div",{className:(0,ej.cn)("flex-1 relative",ea),style:{backgroundImage:er?"url(".concat(er,")"):void 0,backgroundSize:"cover",backgroundPosition:"center"},children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm"}),(0,r.jsx)(V.F,{className:"h-full absolute inset-0",children:(0,r.jsx)(c.Wu,{className:"p-4 space-y-4 text-sm ",children:E?(0,r.jsx)("div",{className:"flex justify-center items-center h-32",children:(0,r.jsx)("div",{className:"text-muted-foreground",children:"Cargando mensajes..."})}):0===p.length?(0,r.jsx)("div",{className:"flex justify-center items-center h-32",children:(0,r.jsx)("div",{className:"text-muted-foreground",children:"No hay mensajes a\xfan. \xa1Env\xeda el primero!"})}):(0,r.jsxs)(r.Fragment,{children:[p.map((e,a)=>{var t;return(0,r.jsxs)("div",{className:"flex gap-2 items-end ".concat("current-user-id"===e.sender?"justify-end":"justify-start"),ref:a===p.length-1?ez:null,children:["current-user-id"!==e.sender&&(0,r.jsxs)(n.eu,{className:"h-6 w-6",children:[(0,r.jsx)(n.BK,{src:null==eE?void 0:eE.avatarUrl}),(0,r.jsx)(n.q5,{children:(null==eE||null==(t=eE.name)?void 0:t.substring(0,1))||"U"})]}),(0,r.jsx)("div",{className:"p-3 rounded-xl max-w-md shadow-md ".concat("current-user-id"===e.sender?"bg-primary text-primary-foreground rounded-br-none":"bg-card text-card-foreground rounded-bl-none"),children:"image"===e.type&&e.imageUrl?(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"relative w-48 h-32 rounded-lg overflow-hidden",children:(0,r.jsx)(em.default,{src:e.imageUrl,alt:"Imagen enviada",fill:!0,className:"object-cover"})}),(0,r.jsx)("p",{className:"text-xs opacity-75",children:e.text})]}):"voice"===e.type?(0,r.jsxs)("div",{className:"flex items-center gap-2 min-w-32",children:[(0,r.jsx)(i.$,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0 hover:bg-white/20",onClick:()=>eT(e),children:ef===e.id?(0,r.jsx)(I.A,{className:"h-4 w-4"}):(0,r.jsx)(U.A,{className:"h-4 w-4"})}),(0,r.jsx)("span",{className:"text-xs",children:e.text})]}):e.text})]},e.id||a)}),f.length>0&&(0,r.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground animate-pulse",children:[(0,r.jsxs)("div",{className:"flex space-x-1",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-primary rounded-full animate-bounce"}),(0,r.jsx)("div",{className:"w-2 h-2 bg-primary rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,r.jsx)("div",{className:"w-2 h-2 bg-primary rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),(0,r.jsx)("span",{children:1===f.length?"".concat(f[0]," est\xe1 escribiendo..."):"".concat(f.slice(0,-1).join(", ")," y ").concat(f[f.length-1]," est\xe1n escribiendo...")})]})]})})})]}),!ey&&/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(0,r.jsx)("div",{className:"p-4 border-t bg-yellow-50 dark:bg-yellow-900/20",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:"Audio deshabilitado"}),(0,r.jsx)("p",{className:"text-xs text-yellow-600 dark:text-yellow-300",children:"Habilita el audio para reproducir mensajes de voz"})]}),(0,r.jsx)(i.$,{size:"sm",onClick:eR,className:"bg-yellow-600 hover:bg-yellow-700 text-white",children:"Habilitar Audio"})]})}),(0,r.jsxs)("form",{onSubmit:eL,className:"p-4 border-t bg-card flex items-center gap-2 z-10",children:[(0,r.jsxs)(G.rI,{children:[(0,r.jsx)(G.ty,{asChild:!0,children:(0,r.jsx)(i.$,{type:"button",size:"icon",variant:"ghost",children:(0,r.jsx)(M.A,{className:"h-5 w-5"})})}),(0,r.jsxs)(G.SQ,{align:"start",children:[(0,r.jsxs)(G._2,{onClick:()=>{if(!d.camera)return void X(!0);Y(!0)},children:[(0,r.jsx)(_.A,{className:"mr-2"}),(0,r.jsx)("span",{children:"C\xe1mara"})]}),(0,r.jsxs)(G._2,{onClick:()=>{var e;return null==(e=ee.current)?void 0:e.click()},children:[(0,r.jsx)(O.A,{className:"mr-2"}),(0,r.jsx)("span",{children:"Galer\xeda"})]}),(0,r.jsxs)(G._2,{onClick:()=>{var e;return null==(e=ee.current)?void 0:e.click()},children:[(0,r.jsx)(D.A,{className:"mr-2"}),(0,r.jsx)("span",{children:"Documento"})]}),(0,r.jsxs)(G._2,{children:[(0,r.jsx)(P.A,{className:"mr-2"}),(0,r.jsx)("span",{children:"Contacto"})]})]})]}),(0,r.jsx)("input",{type:"file",ref:ee,className:"hidden"}),(0,r.jsxs)(G.rI,{children:[(0,r.jsx)(G.ty,{asChild:!0,children:(0,r.jsx)(i.$,{type:"button",size:"icon",variant:"ghost",children:(0,r.jsx)(B.A,{className:"h-5 w-5"})})}),(0,r.jsxs)(G.SQ,{align:"start",children:[(0,r.jsx)(G.lp,{children:"Stickers"}),(0,r.jsx)(G.mB,{}),(0,r.jsx)(G._2,{children:"\uD83D\uDE02 Reacciones"}),(0,r.jsx)(G._2,{children:"\uD83C\uDFC6 Gaming"}),(0,r.jsx)(G._2,{children:"\uD83C\uDF89 Celebraci\xf3n"})]})]}),(0,r.jsx)(o.p,{placeholder:"Escribe un mensaje...",className:"flex-1 bg-background rounded-full px-4",value:q,onChange:e=>{Z(e.target.value),eC()}}),(0,r.jsx)(i.$,{type:"button",size:"icon",variant:"ghost",onClick:()=>{if(!d.microphone)return void X(!0);Q(!0)},children:(0,r.jsx)($.A,{className:"h-5 w-5"})}),(0,r.jsx)(i.$,{type:"submit",size:"icon",className:"rounded-full",children:(0,r.jsx)(F.A,{className:"h-5 w-5"})})]})]}),(0,r.jsx)(H.lG,{open:J,onOpenChange:Q,children:(0,r.jsxs)(H.Cf,{className:"max-w-md",children:[(0,r.jsx)(H.c7,{children:(0,r.jsx)(H.L3,{children:"Grabar Mensaje de Voz"})}),(0,r.jsx)(el,{onSendVoiceMessage:(e,a)=>{if(!eE)return;let t={id:Date.now().toString(),sender:"me",text:"\uD83C\uDFA4 Mensaje de voz (".concat(Math.floor(a/60),":").concat((a%60).toString().padStart(2,"0"),")"),content:"\uD83C\uDFA4 Mensaje de voz (".concat(Math.floor(a/60),":").concat((a%60).toString().padStart(2,"0"),")"),timestamp:new Date,type:"voice",audioBlob:e};h(m.map(e=>e.id===eE.id?{...e,messages:[...e.messages,t],lastMessageTimestamp:t.timestamp instanceof Date?t.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t.timestamp}:e)),Q(!1)},maxDuration:120})]})}),(0,r.jsx)(H.lG,{open:W,onOpenChange:Y,children:(0,r.jsxs)(H.Cf,{className:"max-w-2xl",children:[(0,r.jsx)(H.c7,{children:(0,r.jsx)(H.L3,{children:"Capturar Imagen"})}),(0,r.jsx)(eh,{onSendImage:(e,a)=>{if(!eE)return;let t={id:Date.now().toString(),sender:"me",text:"\uD83D\uDCF7 Imagen",content:"\uD83D\uDCF7 Imagen",timestamp:new Date,type:"image",imageUrl:a,imageBlob:e};h(m.map(e=>e.id===eE.id?{...e,messages:[...e.messages,t],lastMessageTimestamp:t.timestamp instanceof Date?t.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t.timestamp}:e)),Y(!1)},maxWidth:1280,maxHeight:720,quality:.8})]})}),(0,r.jsx)(ev.v,{open:K,onOpenChange:X}),(0,r.jsx)(eg,{isOpen:ed,onClose:()=>eu(!1),contactName:eE.name,contactAvatar:eE.avatarUrl,isIncoming:ep,onAnswer:()=>ex(!1),onDecline:()=>{ex(!1),eu(!1)}})]}):(0,r.jsx)("div",{className:"flex items-center justify-center h-[calc(100vh-120px)]",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-muted-foreground mb-4",children:"Chat no encontrado"}),(0,r.jsx)(ew(),{href:"/chats",children:(0,r.jsxs)(i.$,{variant:"outline",children:[(0,r.jsx)(L.A,{className:"h-4 w-4 mr-2"}),"Volver a chats"]})})]})})}},87481:(e,a,t)=>{"use strict";t.d(a,{dj:()=>m,oR:()=>u});var r=t(12115);let s=0,n=new Map,i=e=>{if(n.has(e))return;let a=setTimeout(()=>{n.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,a)},c=(e,a)=>{switch(a.type){case"ADD_TOAST":return{...e,toasts:[a.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===a.toast.id?{...e,...a.toast}:e)};case"DISMISS_TOAST":{let{toastId:t}=a;return t?i(t):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===a.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==a.toastId)}}},o=[],l={toasts:[]};function d(e){l=c(l,e),o.forEach(e=>{e(l)})}function u(e){let{...a}=e,t=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>d({type:"DISMISS_TOAST",toastId:t});return d({type:"ADD_TOAST",toast:{...a,id:t,open:!0,onOpenChange:e=>{e||r()}}}),{id:t,dismiss:r,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function m(){let[e,a]=r.useState(l);return r.useEffect(()=>(o.push(a),()=>{let e=o.indexOf(a);e>-1&&o.splice(e,1)}),[]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}}},e=>{var a=a=>e(e.s=a);e.O(0,[9135,7210,5769,9863,3856,9550,5679,8722,6874,6766,5135,4214,3421,990,2458,9892,2673,9828,8441,1684,7358],()=>a(68736)),_N_E=e.O()}]);