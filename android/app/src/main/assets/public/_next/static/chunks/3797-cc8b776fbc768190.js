"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3797],{4121:(e,t,a)=>{a.d(t,{$H:()=>h,C5:()=>f,UW:()=>p,j6:()=>u,yq:()=>x});var s=a(26715),r=a(5041),o=a(73265),n=a(77548),i=a(35317),l=a(56104),d=a(12115);let c=(0,n.Uz)(),m={all:["posts"],lists:()=>[...m.all,"list"],list:e=>[...m.lists(),{filters:e}],details:()=>[...m.all,"detail"],detail:e=>[...m.details(),e],comments:e=>[...m.detail(e),"comments"]};function u(){let{user:e}=(0,o.kH)(),{posts:t,setPosts:a}=(0,o.SE)(),[s,r]=(0,d.useState)(!0),[n,c]=(0,d.useState)(null);return(0,d.useEffect)(()=>{if(!e)return void r(!1);r(!0),c(null);let t=(0,i.P)((0,i.rJ)(l.db,"feedPosts"),(0,i.My)("createdAt","desc"),(0,i.AB)(50)),s=(0,i.aQ)(t,e=>{try{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),a(t),r(!1),c(null)}catch(e){console.error("Error processing posts:",e),c("Error al cargar publicaciones"),r(!1)}},e=>{console.error("Error in posts subscription:",e),c("Error de conexi\xf3n"),r(!1)});return()=>{s()}},[e,a]),{posts:t,isLoading:s,error:n}}function p(){let e=(0,s.jE)(),{user:t}=(0,o.kH)(),{addPost:a}=(0,o.SE)(),{isOnline:i,addPendingOperation:l}=(0,o.CU)();return(0,r.n)({mutationFn:async e=>{if(!t)throw Error("Usuario no autenticado");let a=(0,n.Qg)(c,"createPost");return(await a(e)).data},onMutate:async e=>{let s={id:"temp-".concat(Date.now()),author:{id:(null==t?void 0:t.uid)||"",displayName:(null==t?void 0:t.displayName)||"Usuario",username:(null==t?void 0:t.displayName)||"usuario",avatarUrl:(null==t?void 0:t.photoURL)||"",bio:"",region:"US",language:"es",mic:!1,roles:["Jugador"],rankTier:"Bronce",stats:{kda:0,wins:0,matches:0},createdAt:new Date,updatedAt:new Date,name:(null==t?void 0:t.displayName)||"Usuario",email:(null==t?void 0:t.email)||"",level:1},timestamp:new Date().toISOString(),content:e.content,imageUrl:e.imageUrl,likes:0,comments:0,shares:0,commentsList:[],likedBy:[],sharedBy:[],interactions:[],createdAt:new Date().toISOString()};return a(s),i||l({id:s.id,type:"createPost",data:e,timestamp:Date.now()}),{tempPost:s}},onSuccess:(t,s,r)=>{if(null==r?void 0:r.tempPost){let{updatePost:e,removePost:s}=o.SE.getState();s(r.tempPost.id),a(t)}e.invalidateQueries({queryKey:m.lists()})},onError:(e,t,a)=>{if(null==a?void 0:a.tempPost){let{removePost:e}=o.SE.getState();e(a.tempPost.id)}}})}function h(){(0,s.jE)();let{user:e}=(0,o.kH)(),{optimisticLike:t,optimisticUnlike:a}=(0,o.SE)(),{isOnline:i,addPendingOperation:l}=(0,o.CU)();return(0,r.n)({mutationFn:async t=>{let{postId:a,isLiked:s}=t;if(!e)throw Error("Usuario no autenticado");let r=(0,n.Qg)(c,"toggleLike");return(await r({postId:a})).data},onMutate:async s=>{let{postId:r,isLiked:o}=s;if(e)return o?a(r,e.uid):t(r,e.uid),i||l({id:"like-".concat(r,"-").concat(Date.now()),type:"toggleLike",data:{postId:r},timestamp:Date.now()}),{postId:r,isLiked:o,userId:e.uid}},onError:(e,s,r)=>{let{postId:o,isLiked:n}=s;(null==r?void 0:r.userId)&&(n?t(o,r.userId):a(o,r.userId))}})}function x(){let e=(0,s.jE)(),{user:t}=(0,o.kH)(),{updatePost:a}=(0,o.SE)(),{isOnline:i,addPendingOperation:l}=(0,o.CU)();return(0,r.n)({mutationFn:async e=>{let{postId:a,content:s}=e;if(!t)throw Error("Usuario no autenticado");let r=(0,n.Qg)(c,"addComment");return(await r({postId:a,content:s})).data},onMutate:async e=>{let{postId:s,content:r}=e;if(!t)return;let n={id:"temp-".concat(Date.now()),postId:s,author:{id:t.uid,displayName:t.displayName||"Usuario",username:t.displayName||"usuario",avatarUrl:t.photoURL||"",bio:"",region:"US",language:"es",mic:!1,roles:["Jugador"],rankTier:"Bronce",stats:{kda:0,wins:0,matches:0},createdAt:new Date,updatedAt:new Date,name:t.displayName||"Usuario",email:t.email||"",level:1},text:r,timestamp:new Date().toISOString(),likes:0,likedBy:[],createdAt:new Date().toISOString()},{posts:d}=o.SE.getState(),c=d.find(e=>e.id===s);return c&&a(s,{commentsList:[...c.commentsList||[],n],comments:(c.comments||0)+1}),i||l({id:n.id,type:"addComment",data:{postId:s,content:r},timestamp:Date.now()}),{tempComment:n,postId:s}},onSuccess:(t,s,r)=>{let{postId:n}=s;if(null==r?void 0:r.tempComment){let{posts:e}=o.SE.getState(),s=e.find(e=>e.id===n);if(s){var i;a(n,{commentsList:(null==(i=s.commentsList)?void 0:i.map(e=>e.id===r.tempComment.id?t:e))||[]})}}e.invalidateQueries({queryKey:m.comments(n)})},onError:(e,t,s)=>{let{postId:r}=t;if(null==s?void 0:s.tempComment){let{posts:e}=o.SE.getState(),t=e.find(e=>e.id===r);if(t){var n;a(r,{commentsList:(null==(n=t.commentsList)?void 0:n.filter(e=>e.id!==s.tempComment.id))||[],comments:Math.max(0,(t.comments||0)-1)})}}}})}function f(){(0,s.jE)();let{user:e}=(0,o.kH)(),{toggleBookmark:t}=(0,o.SE)(),{isOnline:a,addPendingOperation:i}=(0,o.CU)();return(0,r.n)({mutationFn:async t=>{let{postId:a,isBookmarked:s}=t;if(!e)throw Error("Usuario no autenticado");let r=(0,n.Qg)(c,s?"unbookmarkPost":"bookmarkPost");return(await r({postId:a})).data},onMutate:async e=>{let{postId:s,isBookmarked:r}=e;return t(s),a||i({id:"bookmark-".concat(s,"-").concat(Date.now()),type:r?"unbookmarkPost":"bookmarkPost",data:{postId:s},timestamp:Date.now()}),{postId:s,isBookmarked:r}},onError:(e,a,s)=>{let{postId:r}=a;t(r)}})}},44838:(e,t,a)=>{a.d(t,{I:()=>u,SQ:()=>p,_2:()=>h,lp:()=>x,mB:()=>f,rI:()=>c,ty:()=>m});var s=a(95155),r=a(12115),o=a(76215),n=a(73158),i=a(10518),l=a(70154),d=a(59434);let c=o.bL,m=o.l9,u=o.YJ;o.ZL,o.Pb,o.z6,r.forwardRef((e,t)=>{let{className:a,inset:r,children:i,...l}=e;return(0,s.jsxs)(o.ZP,{ref:t,className:(0,d.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",a),...l,children:[i,(0,s.jsx)(n.A,{className:"ml-auto"})]})}).displayName=o.ZP.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(o.G5,{ref:t,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})}).displayName=o.G5.displayName;let p=r.forwardRef((e,t)=>{let{className:a,sideOffset:r=4,...n}=e;return(0,s.jsx)(o.ZL,{children:(0,s.jsx)(o.UC,{ref:t,sideOffset:r,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})})});p.displayName=o.UC.displayName;let h=r.forwardRef((e,t)=>{let{className:a,inset:r,...n}=e;return(0,s.jsx)(o.q7,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",a),...n})});h.displayName=o.q7.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,checked:n,...l}=e;return(0,s.jsxs)(o.H_,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:n,...l,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(o.VF,{children:(0,s.jsx)(i.A,{className:"h-4 w-4"})})}),r]})}).displayName=o.H_.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,...n}=e;return(0,s.jsxs)(o.hN,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(o.VF,{children:(0,s.jsx)(l.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=o.hN.displayName;let x=r.forwardRef((e,t)=>{let{className:a,inset:r,...n}=e;return(0,s.jsx)(o.JU,{ref:t,className:(0,d.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",a),...n})});x.displayName=o.JU.displayName;let f=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(o.wv,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",a),...r})});f.displayName=o.wv.displayName},60595:(e,t,a)=>{a.d(t,{p:()=>U});var s=a(95155),r=a(12115),o=a(30285),n=a(66695),i=a(91394),l=a(88539),d=a(54165),c=a(44838),m=a(3561),u=a(18763),p=a(77223),h=a(68098),x=a(38224),f=a(73672),g=a(7390),v=a(19774),N=a(4121),y=a(73265),j=a(59434),w=a(35095),b=a(61055),S=a(66766),k=a(6874),E=a.n(k);function U(e){var t,a;let{post:k}=e,{user:U}=(0,y.kH)(),{bookmarkedPosts:A}=(0,y.SE)(),[C,_]=(0,r.useState)(!1),[I,P]=(0,r.useState)(""),L=(0,N.$H)(),q=(0,N.yq)(),D=(0,N.C5)(),z=(null==(t=k.likedBy)?void 0:t.includes((null==U?void 0:U.uid)||""))||!1,R=A.includes(k.id),H=async()=>{if(U&&I.trim())try{await q.mutateAsync({postId:k.id,content:I.trim()}),P("")}catch(e){console.error("Error adding comment:",e)}},B=async()=>{if(navigator.share)try{await navigator.share({title:"Post de ".concat(k.author.displayName||k.author.username),text:k.content,url:window.location.href})}catch(e){console.log("Error sharing:",e)}else navigator.clipboard.writeText(window.location.href)};return(0,s.jsxs)(n.Zp,{className:"w-full max-w-2xl mx-auto mb-6 shadow-lg hover:shadow-xl transition-shadow duration-300",children:[(0,s.jsx)(n.aR,{className:"pb-3",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(E(),{href:"/profile/".concat(k.author.id),children:(0,s.jsxs)(i.eu,{className:"h-12 w-12 ring-2 ring-primary/10 hover:ring-primary/30 transition-all cursor-pointer",children:[(0,s.jsx)(i.BK,{src:k.author.avatar,alt:k.author.displayName||k.author.username}),(0,s.jsx)(i.q5,{className:"bg-gradient-to-br from-primary/20 to-primary/10 text-primary font-semibold",children:(k.author.displayName||k.author.username).charAt(0).toUpperCase()})]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)(E(),{href:"/profile/".concat(k.author.id),className:"hover:underline",children:(0,s.jsx)("h3",{className:"font-semibold text-foreground hover:text-primary transition-colors",children:k.author.displayName||k.author.username})}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:k.createdAt?(0,w.m)(new Date(k.createdAt),{addSuffix:!0,locale:b.es}):"Hace un momento"})]})]}),(null==U?void 0:U.uid)===k.author.id&&(0,s.jsxs)(c.rI,{children:[(0,s.jsx)(c.ty,{asChild:!0,children:(0,s.jsx)(o.$,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:(0,s.jsx)(m.A,{className:"h-4 w-4"})})}),(0,s.jsxs)(c.SQ,{align:"end",children:[(0,s.jsxs)(c._2,{children:[(0,s.jsx)(u.A,{className:"mr-2 h-4 w-4"}),"Editar"]}),(0,s.jsxs)(c._2,{className:"text-destructive",children:[(0,s.jsx)(p.A,{className:"mr-2 h-4 w-4"}),"Eliminar"]})]})]})]})}),(0,s.jsxs)(n.Wu,{className:"pt-0",children:[(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsx)("p",{className:"text-foreground leading-relaxed whitespace-pre-wrap",children:k.content})}),k.imageUrl&&(0,s.jsx)("div",{className:"mb-4 rounded-lg overflow-hidden",children:(0,s.jsx)(S.default,{src:k.imageUrl,alt:"Post image",width:600,height:400,className:"w-full h-auto object-cover hover:scale-105 transition-transform duration-300"})}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm text-muted-foreground mb-4 px-1",children:[(0,s.jsxs)("span",{children:[k.likes||0," me gusta"]}),(0,s.jsxs)("span",{children:[(null==(a=k.commentsList)?void 0:a.length)||0," comentarios"]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between border-t pt-3",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,s.jsxs)(o.$,{variant:"ghost",size:"sm",onClick:()=>{U&&L.mutate({postId:k.id,isLiked:z})},disabled:L.isPending,className:(0,j.cn)("flex items-center space-x-2 hover:bg-red-50 hover:text-red-600 transition-colors",z&&"text-red-600 bg-red-50"),children:[(0,s.jsx)(h.A,{className:(0,j.cn)("h-5 w-5",z&&"fill-current")}),(0,s.jsx)("span",{children:"Me gusta"})]}),(0,s.jsxs)(d.lG,{open:C,onOpenChange:_,children:[(0,s.jsx)(d.zM,{asChild:!0,children:(0,s.jsxs)(o.$,{variant:"ghost",size:"sm",className:"flex items-center space-x-2 hover:bg-blue-50 hover:text-blue-600 transition-colors",children:[(0,s.jsx)(x.A,{className:"h-5 w-5"}),(0,s.jsx)("span",{children:"Comentar"})]})}),(0,s.jsxs)(d.Cf,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[(0,s.jsx)(d.c7,{children:(0,s.jsx)(d.L3,{children:"Comentarios"})}),(0,s.jsx)("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:k.commentsList&&k.commentsList.length>0?k.commentsList.map(e=>(0,s.jsxs)("div",{className:"flex space-x-3 p-3 rounded-lg bg-muted/30",children:[(0,s.jsxs)(i.eu,{className:"h-8 w-8",children:[(0,s.jsx)(i.BK,{src:e.author.avatar,alt:e.author.displayName||e.author.username}),(0,s.jsx)(i.q5,{className:"text-xs",children:(e.author.displayName||e.author.username).charAt(0).toUpperCase()})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{className:"font-medium text-sm",children:e.author.displayName||e.author.username}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:e.createdAt?(0,w.m)(new Date(e.createdAt),{addSuffix:!0,locale:b.es}):"Hace un momento"})]}),(0,s.jsx)("p",{className:"text-sm mt-1",children:e.text})]})]},e.id)):(0,s.jsx)("p",{className:"text-center text-muted-foreground py-8",children:"No hay comentarios a\xfan"})}),U&&(0,s.jsxs)("div",{className:"flex space-x-3 pt-4 border-t",children:[(0,s.jsxs)(i.eu,{className:"h-8 w-8",children:[(0,s.jsx)(i.BK,{src:U.photoURL||"",alt:U.displayName||""}),(0,s.jsx)(i.q5,{className:"text-xs",children:(U.displayName||"U").charAt(0).toUpperCase()})]}),(0,s.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,s.jsx)(l.T,{placeholder:"Escribe un comentario...",value:I,onChange:e=>P(e.target.value),className:"min-h-[80px] resize-none"}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsxs)(o.$,{onClick:H,disabled:!I.trim()||q.isPending,size:"sm",className:"flex items-center space-x-2",children:[(0,s.jsx)(f.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:"Comentar"})]})})]})]})]})]}),(0,s.jsxs)(o.$,{variant:"ghost",size:"sm",onClick:B,className:"flex items-center space-x-2 hover:bg-green-50 hover:text-green-600 transition-colors",children:[(0,s.jsx)(g.A,{className:"h-5 w-5"}),(0,s.jsx)("span",{children:"Compartir"})]})]}),(0,s.jsxs)(o.$,{variant:"ghost",size:"sm",onClick:()=>{U&&D.mutate({postId:k.id,isBookmarked:R})},disabled:D.isPending,className:(0,j.cn)("flex items-center space-x-2 hover:bg-yellow-50 hover:text-yellow-600 transition-colors",R&&"text-yellow-600 bg-yellow-50"),children:[(0,s.jsx)(v.A,{className:(0,j.cn)("h-5 w-5",R&&"fill-current")}),(0,s.jsx)("span",{children:"Guardar"})]})]})]})]})}},67491:(e,t,a)=>{a.d(t,{A:()=>d,AuthProvider:()=>l});var s=a(95155),r=a(12115),o=a(24903),n=a(56104);let i=(0,r.createContext)({user:null,loading:!0}),l=e=>{let{children:t}=e,[a,l]=(0,r.useState)(null),[d,c]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{console.log("\uD83D\uDD27 AuthProvider - Configurando listener de autenticaci\xf3n"),(()=>{{let e=localStorage.getItem("squadgo_user"),t=localStorage.getItem("squadgo_user_backup");if(e||t)try{let a=JSON.parse(e||t||"{}");console.log("\uD83D\uDD04 AuthProvider - Intentando recuperar sesi\xf3n desde localStorage:",a.uid)}catch(e){console.error("❌ Error recuperando usuario desde localStorage:",e),localStorage.removeItem("squadgo_user"),localStorage.removeItem("squadgo_user_backup")}}})();let e=(0,o.onAuthStateChanged)(n.j2,async e=>{if(console.log("\uD83D\uDD04 AuthProvider - Estado de autenticaci\xf3n cambi\xf3:",{uid:null==e?void 0:e.uid,email:null==e?void 0:e.email,emailVerified:null==e?void 0:e.emailVerified}),e)try{console.log("✅ AuthProvider - Usuario autenticado"),l(e);{let t={uid:e.uid,email:e.email||"",displayName:e.displayName||"",photoURL:e.photoURL||"",emailVerified:e.emailVerified,lastUpdate:Date.now(),sessionId:Math.random().toString(36).substring(2,11)};localStorage.setItem("squadgo_user",JSON.stringify(t)),localStorage.setItem("squadgo_user_backup",JSON.stringify(t));let a=new CustomEvent("userAuthenticated",{detail:{user:e}});window.dispatchEvent(a)}}catch(e){console.error("❌ AuthProvider - Error procesando usuario:",e),l(null),localStorage.removeItem("squadgo_user"),localStorage.removeItem("squadgo_user_backup")}else{console.log("\uD83D\uDEAB AuthProvider - Usuario no autenticado"),l(null);{let e=localStorage.getItem("squadgo_user_backup");if(e)try{let t=JSON.parse(e);Date.now()-(t.lastUpdate||0)>864e5?(localStorage.removeItem("squadgo_user"),localStorage.removeItem("squadgo_user_backup"),console.log("\uD83E\uDDF9 Limpiando datos de sesi\xf3n expirados")):console.log("\uD83D\uDD04 Manteniendo backup de sesi\xf3n reciente")}catch(e){localStorage.removeItem("squadgo_user"),localStorage.removeItem("squadgo_user_backup")}else localStorage.removeItem("squadgo_user")}}c(!1)});return()=>{console.log("\uD83E\uDDF9 AuthProvider - Limpiando listener de autenticaci\xf3n"),e()}},[]),(0,s.jsx)(i.Provider,{value:{user:a,loading:d},children:t})},d=()=>(0,r.useContext)(i)}}]);